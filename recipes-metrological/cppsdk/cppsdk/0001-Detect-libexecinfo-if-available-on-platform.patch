From f3e4bc4ef7f0ed7c6b848ef28f8b060c11da4e28 Mon Sep 17 00:00:00 2001
From: Khem Raj <raj.khem@gmail.com>
Date: Sun, 19 Mar 2017 18:01:55 -0700
Subject: [PATCH] Detect libexecinfo if available on platform

Some platform e.g. freebsd or musl based linux platforms
where backtrace() API is not available, there is external
library libexecinfo which provides same funcitonality
try to find this library if available add it to linker
cmdline

Signed-off-by: Khem Raj <raj.khem@gmail.com>
---
 generics/CMakeLists.txt  | 5 ++++-
 generics/Portability.cpp | 1 +
 generics/SocketPort.cpp  | 1 +
 3 files changed, 6 insertions(+), 1 deletion(-)

Index: git/generics/CMakeLists.txt
===================================================================
--- git.orig/generics/CMakeLists.txt
+++ git/generics/CMakeLists.txt
@@ -4,6 +4,9 @@ set(CMAKE_REQUIRED_LIBRARIES rt)
 CHECK_SYMBOL_EXISTS(_POSIX_TIMERS "unistd.h;time.h" GENERICS_POSIX_TIMERS)
 set(CMAKE_REQUIRED_LIBRARIES ${CMAKE_REQUIRED_LIBRARIES_SAVE})
 
+find_library(GENERICS_EXECINFO_LIBRARY NAMES execinfo)
+mark_as_advanced(GENERICS_EXEXINFO_LIBRARY)
+
 if(GENERICS_POSIX_TIMERS)
   find_library(GENERICS_RT_LIBRARY NAMES rt)
   mark_as_advanced(GENERICS_RT_LIBRARY)
@@ -13,6 +16,7 @@ set(GENERICS_LIBS
         ${CMAKE_THREAD_LIBS_INIT}
         ${CMAKE_DL_LIBS}
         ${GENERICS_RT_LIBRARY}
+        ${GENERICS_EXECINFO_LIBRARY}
 )
 
 set(GENERICS_SOURCES 
Index: git/generics/Portability.cpp
===================================================================
--- git.orig/generics/Portability.cpp
+++ git/generics/Portability.cpp
@@ -6,6 +6,7 @@
 
 #ifdef __LINUX__
 #include <signal.h>
+#include <execinfo.h>
 
 #define CALLSTACK_SIG SIGUSR2
 #endif
Index: git/generics/SocketPort.cpp
===================================================================
--- git.orig/generics/SocketPort.cpp
+++ git/generics/SocketPort.cpp
@@ -21,6 +21,7 @@
 #include <sys/ioctl.h>
 #include <sys/signalfd.h>
 #include <signal.h>
+#include <execinfo.h>
 #endif
 
 #ifdef __WIN32__
